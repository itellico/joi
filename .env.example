# JOI - Personal AI Assistant
# Copy to .env and fill in your values.
#
# === Architecture ===
# Dev (studio/air Mac):  gateway runs locally, DB/Redis/Ollama/LiveKit on mini via host alias `mini`
# Prod (mini Mac):   everything runs on mini, services use localhost
#
# Road mode uses /etc/hosts switching for alias `mini`:
#   Home LAN:    192.168.178.58 mini
#   Tailscale:   <mini-tailscale-ip> mini
# Helper: ./scripts/road-mode-hosts.sh status|home|road|auto [--apply]
#
# Startup scripts also resolve mini -> active Home/Road IP at runtime
# without editing /etc/hosts:
#   ./scripts/mini-runtime-env.sh --plain

# ── Core services ──────────────────────────────────────────────
# Dev:  postgresql://joi:joi@mini:5434/joi
# Prod: postgresql://joi:joi@localhost:5434/joi
DATABASE_URL=postgresql://joi:joi@mini:5434/joi

GATEWAY_PORT=3100
GATEWAY_PUBLIC_URL=https://joi.itellico.org
# Optional explicit webhook base override (used by Channels integration cards).
# JOI_WEBHOOK_BASE_URL=https://joi.itellico.org
# JOI_WEBHOOK_BASE_URL_HOME=http://192.168.178.58:3100
# JOI_WEBHOOK_BASE_URL_ROAD=http://100.64.0.10:3100

# Dev:  http://mini:11434
# Prod: http://localhost:11434
OLLAMA_URL=http://mini:11434

# ── Memory (pgvector) ─────────────────────────────────────────
MEM0_VECTOR_BACKEND=pgvector
MEM0_PGVECTOR_TABLE=mem0_vectors
MEM0_SHADOW_WRITE_LOCAL=false

# ── Outline wiki ───────────────────────────────────────────────
OUTLINE_API_KEY=ol_api_...
OUTLINE_API_URL=https://go-outline.itellico.ai/api
OUTLINE_SYNC_ENABLED=true

# ── LLM providers ─────────────────────────────────────────────
OPENROUTER_MGMT_KEY=sk-or-v1-...

# ── iMessage (BlueBubbles) ─────────────────────────────────────
BLUEBUBBLES_URL=http://localhost:1234
BLUEBUBBLES_PASSWORD=

# ── Telegram ───────────────────────────────────────────────────
TELEGRAM_API_ID=
TELEGRAM_API_HASH=
TELEGRAM_BOT_USERNAME=
TELEGRAM_CHAT_ID=

# ── Apple Push Notifications ──────────────────────────────────
APNS_KEY_PATH=./secrets/AuthKey_XXXXXXXXXX.p8
APNS_KEY_ID=
APNS_TEAM_ID=
APNS_BUNDLE_ID=com.joi.app.ios
APNS_BUNDLE_ID_DEVELOPMENT=com.joi.app.ios
APNS_BUNDLE_ID_PRODUCTION=com.joi.app.ios
APNS_PRODUCTION=false

# ── LiveKit (voice) ────────────────────────────────────────────
# Dev:  ws://mini:7880
# Prod: ws://localhost:7880
LIVEKIT_URL=ws://mini:7880
# Optional explicit mini routing targets used by gateway /api/livekit/config and /api/livekit/token.
# Set these for stable home/road switching without relying only on DNS/hosts.
JOI_MINI_HOME_IP=192.168.178.58
JOI_MINI_ROAD_IP=100.64.0.10
# Optional route mode override: auto | home | road (default auto)
JOI_LIVEKIT_NETWORK_MODE=auto
# Optional: allow clients to force home/road via API (default off).
# JOI_LIVEKIT_ALLOW_MODE_OVERRIDE=1
LIVEKIT_API_KEY=joi-api-key
LIVEKIT_API_SECRET=joi-api-secret-that-is-at-least-32-chars
DEEPGRAM_API_KEY=
CARTESIA_API_KEY=

# ── TTS cache (Redis) ─────────────────────────────────────────
# Dev:  redis://mini:6379/0
# Prod: redis://localhost:6379/0
JOI_TTS_CACHE_REDIS_URL=redis://mini:6379/0
JOI_TTS_CACHE_REDIS_TTL_SEC=604800

# ── Simulation / Shadow testing ───────────────────────────────
# live | shadow | dry_run
JOI_DEFAULT_EXECUTION_MODE=shadow
# Optional: run simulation against a separate database.
JOI_SHADOW_DATABASE_URL=postgresql://joi:joi@mini:5434/joi_shadow
# 1 disables side-effecting background services
JOI_DISABLE_SCHEDULER=1
JOI_DISABLE_CHANNEL_AUTOSTART=1
JOI_DISABLE_CLOUD_SYNC=1
# Optional per-case QA timeout in ms
JOI_QA_CASE_TIMEOUT_MS=90000

# ── AutoDev orchestration ──────────────────────────────────────
# auto | claude-code | codex-cli | gemini-cli
JOI_AUTODEV_EXECUTOR_MODE=auto
# Writer + shadow (only when executor mode is auto and no strict route)
JOI_AUTODEV_PARALLEL_EXECUTION=true
# Optional per-executor timeouts (ms)
# JOI_AUTODEV_CLAUDE_TIMEOUT_MS=1800000
# JOI_AUTODEV_CODEX_TIMEOUT_MS=1800000
# JOI_AUTODEV_GEMINI_TIMEOUT_MS=1800000

# Discussion mode:
# When enabled, AutoDev runs Codex<->Claude discussion turns first,
# then forces final execution on Codex.
JOI_AUTODEV_DISCUSSION_MODE=false
# Max discussion turns, bounded to 1..5 in code
JOI_AUTODEV_DISCUSSION_MAX_TURNS=5
